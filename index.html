<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Gold Biscuit Authentication</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --pad:16px; }
    body { font-family: Arial, sans-serif; margin:0; padding:var(--pad); background:#f7f7f9; }
    .wrap { max-width: 540px; margin: 0 auto; }
    .card { background:#fff; border-radius:12px; padding:var(--pad); box-shadow:0 6px 18px rgba(0,0,0,0.08); }
    .brand { text-align:center; margin-bottom:18px; }
    .brand h2 { margin:6px 0 0; font-weight:700; letter-spacing:0.5px; }
    label { display:block; font-weight:600; margin:12px 0 6px; }
    input { width:100%; padding:12px; border:1px solid #ddd; border-radius:10px; font-size:16px; }
    button { margin-top:12px; width:100%; padding:12px; border:0; border-radius:10px; font-size:16px; cursor:pointer; background:#111; color:#fff; }
    .hint { font-size:12px; color:#666; margin-top:6px; }
    .err { color:#b00020; margin-top:10px; font-weight:600; display:none; }

    /* Popup */
    .popup { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.55); padding:16px; }
    .popup.on { display:flex; }
    .modal { width:100%; max-width:520px; background:#fff; border-radius:14px; overflow:hidden; animation:rise .18s ease-out; }
    @keyframes rise { from { transform:translateY(10px); opacity:0; } to { transform:translateY(0); opacity:1; } }
    .modal-header { padding:14px 16px; border-bottom:1px solid #eee; display:flex; align-items:center; justify-content:space-between; }
    .modal-header h3 { margin:0; font-size:18px; }
    .modal-body { padding:16px; }
    .grid { display:grid; grid-template-columns:1fr; gap:10px; }
    .imgbox img { width:100%; border-radius:10px; display:block; }
    .meta { background:#fafafa; border:1px solid #eee; border-radius:10px; padding:12px; }
    .row { display:flex; justify-content:space-between; margin:6px 0; }
    .k { color:#666; }
    .v { font-weight:600; }
    .close { background:#111; color:#fff; border:0; padding:10px 12px; border-radius:10px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <h2>Gold Biscuit Verification</h2>
      <div class="hint">Scan â†’ enter serial engraved on the biscuit (e.g., AB1234)</div>
    </div>

    <div class="card">
      <label for="serial">Enter Serial #</label>
      <input id="serial" placeholder="e.g., AB1234" autocomplete="off" />
      <div class="hint">Tip: Use uppercase letters (as engraved)</div>
      <button id="checkBtn">View Details</button>
      <div id="err" class="err">Serial not found. Please check and try again.</div>
    </div>
  </div>

  <!-- Popup -->
  <div id="popup" class="popup" role="dialog" aria-modal="true" aria-labelledby="title">
    <div class="modal">
      <div class="modal-header">
        <h3 id="title">Biscuit Details</h3>
        <button class="close" id="closeBtn" aria-label="Close">Close</button>
      </div>
      <div class="modal-body">
        <div class="grid">
          <div class="imgbox"><img id="img1" alt="Biscuit image" /></div>
          <div class="imgbox" id="img2wrap" style="display:none"><img id="img2" alt="Biscuit image 2" /></div>
          <div class="meta">
            <div class="row"><div class="k">Serial</div><div class="v" id="m_serial"></div></div>
            <div class="row"><div class="k">Purity</div><div class="v" id="m_purity"></div></div>
            <div class="row"><div class="k">Weight</div><div class="v" id="m_weight"></div></div>
            <div class="row"><div class="k">Batch</div><div class="v" id="m_batch"></div></div>
            <div class="row"><div class="k">Minted</div><div class="v" id="m_minted"></div></div>
          </div>
          <div class="meta" id="descwrap" style="display:none">
            <div class="row" style="display:block">
              <div class="k" style="margin-bottom:6px;">Description</div>
              <div class="v" id="m_desc" style="font-weight:500;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(async function(){
  // IMPORTANT: When you publish, this file and data.json must be in the same folder.
  async function loadData() {
    const resp = await fetch('data.json', {cache:'no-store'});
    if (!resp.ok) throw new Error('Failed to load data.json');
    return resp.json();
  }

  const $ = sel => document.querySelector(sel);
  const serialInput = $('#serial');
  const errBox = $('#err');
  const popup = $('#popup');

  const showPopup = rec => {
    $('#title').textContent = `Biscuit: ${rec.serial}`;
    $('#m_serial').textContent = rec.serial || '-';
    $('#m_purity').textContent = rec.purity || '-';
    $('#m_weight').textContent = rec.weight || '-';
    $('#m_batch').textContent = rec.batch || '-';
    $('#m_minted').textContent = rec.minted || '-';
    $('#m_desc').textContent = rec.description || '';
    $('#descwrap').style.display = rec.description ? 'block' : 'none';

    $('#img1').src = rec.images?.[0] || '';
    if (rec.images?.[1]) {
      $('#img2wrap').style.display = 'block';
      $('#img2').src = rec.images[1];
    } else {
      $('#img2wrap').style.display = 'none';
      $('#img2').removeAttribute('src');
    }

    popup.classList.add('on');
  };

  $('#closeBtn').addEventListener('click', ()=> popup.classList.remove('on'));
  popup.addEventListener('click', e => { if (e.target === popup) popup.classList.remove('on'); });

  async function handleLookup() {
    errBox.style.display = 'none';
    const serial = (serialInput.value || '').trim().toUpperCase();
    if (!serial) { errBox.textContent = 'Please enter a serial.'; errBox.style.display='block'; return; }

    try {
      const all = await loadData();
      const rec = all[serial];
      if (!rec) { errBox.textContent = 'Serial not found. Please check and try again.'; errBox.style.display='block'; return; }
      showPopup(rec);
    } catch (e) {
      errBox.textContent = 'Unable to load data. Try again later.';
      errBox.style.display='block';
    }
  }

  $('#checkBtn').addEventListener('click', handleLookup);
  serialInput.addEventListener('keydown', e => { if (e.key === 'Enter') handleLookup(); });

  // If you pass ?s=AB1234 in the URL, auto-open:
  const url = new URL(location.href);
  const s = url.searchParams.get('s');
  if (s) { serialInput.value = s; handleLookup(); }
})();
</script>
</body>
</html>
